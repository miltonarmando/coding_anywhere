<?php
session_start();
require_once 'database.php';

// Verificar se o usuário está logado
if (!isset($_SESSION['usuario_id'])) {
    header("Location: ../../Automacao.php");
    exit;
}

// Obter o caminho atual
$caminho_atual = $_SERVER['REQUEST_URI'];

// Obter permissões do usuário
$usuario_id = $_SESSION['usuario_id'];
$query = "SELECT * FROM usuarios WHERE usuario_id = :usuario_id";
$stmt = $pdo->prepare($query);
$stmt->execute([':usuario_id' => $usuario_id]);
$usuario = $stmt->fetch(PDO::FETCH_ASSOC);

// Verificar permissões para diretórios
if (strpos($caminho_atual, '/diretorio1/') === 0 && $usuario['diretorio1'] !== 'sim') {
    echo "Acesso negado ao Diretório 1.";
    exit;
}

if (strpos($caminho_atual, '/diretorio2/') === 0 && $usuario['diretorio2'] !== 'sim') {
    echo "Acesso negado ao Diretório 2.";
    exit;
}
?>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta http-equiv="refresh" content="60">
    <title>Painel-CCO</title>
    <link rel="icon" href="../../favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../../apoio/favicon.ico" type="image/x-icon">
    <script src='../../jquery-1.8.3.min.js'></script>
    <script src='../../jquery.elevatezoom.js'></script>
</head>
<body style="background:#000000">
    <div align="center" style="width:100%;height:100%">
        <img src='painelcln.png' width="95%">
        <div align="center" style="width:100%;position:fixed;bottom:0;text-align:center;">
            <hr width="95%">
            <img id="zoom_01" src='painelcln.png' height='140' data-zoom-image="painelcln.png">
            <a href="painelcln.png" download="painelcln.png">
                <img src='../../down.png' height='20'>
            </a>
        </div>
    </div>

    <script>
        var w = window.innerWidth;
        var h = window.innerHeight;

        $("#zoom_01").elevateZoom({
            zoomWindowPosition: 14,
            zoomWindowHeight: h - 150,
            zoomWindowWidth: w - 40,
            borderSize: 0,
            easing: true,
            scrollZoom: true
        });

        $("#zoom_01").click(function () {
            location.reload();
        });
    </script>
</body>
</html>
